---
title: "Analyses & Visualizations from RT study with pictures"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

This R Markdown Notebook contains analyses and visualizations of the reading time norming study using images of faces —  [experiment](https://dmanko99.github.io/Pragmatics-stereotypes/experiments/RT_norming/experiment/RT_pictures.html), [preregistration](https://osf.io/ys4c7) — ran on October 11, 2021. This study builds off of similar reading time studies (such as [this preregistered study](https://osf.io/zwg8n)), with the introduction of participants seeing the face of a Black or White male while reading a sentence where the image matches the predicate.

```{r, echo=FALSE}
knitr::opts_chunk$set(error = TRUE)
```

###Setting up data analysis
```{r eval = FALSE}
#import packages
library(tidyverse)
library(lme4)
library(lmerTest)
library(ggplot2)
library(bootstrap)
library(tm)
library(knitr)

#set working directory
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

#helper scripts
dodge = position_dodge(.9)
theta <- function(x,xdata,na.rm=T) {mean(xdata[x],na.rm=na.rm)}
ci.low <- function(x,na.rm=T) {
  mean(x,na.rm=na.rm) - quantile(bootstrap(1:length(x),1000,theta,x,na.rm=na.rm)$thetastar,.025,na.rm=na.rm)}
ci.high <- function(x,na.rm=T) {
  quantile(bootstrap(1:length(x),1000,theta,x,na.rm=na.rm)$thetastar,.975,na.rm=na.rm) - mean(x,na.rm=na.rm)}

#read in experiment data
df <- read_csv("../data/pictureRT/pictureRT-trials.csv") %>%
  # remove bot check slides
  filter(!(type == "bot_check")) %>%
  # remove the practice trial
  filter(!(type == "practice")) %>%
  # remove non-relevant cols
  select( -c(audio, response, slide_number, slide_type, error)) %>%
  drop_na()

subinfo = read.csv("../data/pictureRT/pictureRT-subject_information.csv", header = TRUE)
```

###Pre-processing experiment data
```{r}
#create trial summary df
by_trial <- df %>%
  group_by(workerid, trial_id, response_correct, nameCategory, bias, type) %>%
  summarise_each(list())

#exclude poor-performing participants (>3 comprehension questions wrong, answering >2 standard deviations faster/slower than the mean)
excludeList <- (by_trial %>%
  group_by(workerid) %>%
  summarize(nWrong = sum(response_correct == 0)) %>%
  ungroup() %>%
  filter(nWrong > 5))$workerid

rawUpperBound = mean(df$rt) + (2*sd(df$rt))
rawLowerBound = mean(df$rt) - (2*sd(df$rt))

df <- df %>%
  filter(!(workerid %in% excludeList)) %>%
  filter(!(rt >= rawUpperBound)) %>%
  filter(!(rt <= rawLowerBound))

#remove punctuation from items as to not mess up word lengths
df$form = gsub("&rsquo;", "", df$form) #removing HTML code for apostrophes
df$form = gsub("&quot;", "", df$form) #removing HTML code for double quotes
df$form = removePunctuation(df$form) #removing all remaining punctuation

#set up different regions
## region names
regionLabels <- c("pre_crit_2",
                  "pre_crit_1",
                  "crit",
                  "spillover_1",
                  "spillover_2",
                  "spillover_3",
                  "spillover_4")

## for critical items
df <- df %>%
  mutate(region_old = region) %>%
  mutate(region = case_when((((lag(region_old) == "filler") & (lead(region_old == "filler"))) &
                               (region_old != "name") & (region_old != "crit"))
                            ~ "filler",
                            region_old == "pre_crit_2" ~ "pre_crit_2",
                            region_old == "pre_crit_1" ~ "pre_crit_1",
                            region_old == "crit" ~ "crit",
                            region_old == "spillover_1" ~ "spillover_1",
                            region_old == "spillover_2" ~ "spillover_2",
                            region_old == "spillover_3" ~ "spillover_3",
                            region_old == "spillover_4" ~ "spillover_4",
                            region_old == "name" ~ "name",
                            region_old == "filler" ~ "filler",
                            TRUE ~ "other")) %>%
  select(-region_old)

## for filler items
fillerdf <- filter(df, type == "filler") %>%
  mutate(region_old = region) %>%
  mutate(region = case_when(((lead(region_old) == "crit") & (lead(trial_id) == trial_id) &
                               (lead(workerid) == workerid) & (type == "filler"))
                            ~ "pre_crit_1",
                            ((lag(region_old) == "crit") & (lag(trial_id) == trial_id) &
                               (lag(workerid) == workerid) & (type == "filler"))
                            ~ "spillover_1",
                            region_old == "crit" ~ "crit",
                            region_old == "name" ~ "name",
                            TRUE ~ "other")) %>%
  mutate(region_old = region) %>%
  mutate(region = case_when(region_old == "pre_crit_1" ~ "pre_crit_1",
                            region_old == "spillover_1" ~ "spillover_1",
                            region_old == "crit" ~ "crit",
                            region_old == "name" ~ "name",
                            ((lead(region_old) == "pre_crit_1") & (lead(trial_id) == trial_id) &
                               (lead(workerid) == workerid) & (type == "filler"))
                            ~ "pre_crit_2",
                            ((lag(region_old) == "spillover_1") & (lag(trial_id) == trial_id) &
                               (lag(workerid) == workerid) & (type == "filler"))
                            ~ "spillover_2",
                            region_old == "pre_crit_2" ~ "pre_crit_2",
                            region_old == "pre_crit_1" ~ "pre_crit_1",
                            region_old == "crit" ~ "crit",
                            region_old == "spillover_1" ~ "spillover_1",
                            region_old == "spillover_2" ~ "spillover_2",
                            region_old == "name" ~ "name",
                            region_old == "filler" ~ "filler",
                            TRUE ~ "other")) %>%
  select(-region_old)

#labelling the data with all regions of interest (pre-critical, critical, and spillover)
subregion_df <- filter(df, region %in% c("pre_crit_2", "pre_crit_1",
                                         "crit", "spillover_1", "spillover_2",
                                         "spillover_3", "spillover_4"),
                       type == "critical")
subregion_df$bias <- factor(subregion_df$bias)
subregion_df$nameCategory <- factor(subregion_df$nameCategory)
subregion_df <- subregion_df %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

subregion_df$ctr_nameCategory = as.numeric(subregion_df$nameCategory) - 
  mean(as.numeric(subregion_df$nameCategory))
subregion_df$ctr_consistency = as.numeric(factor(subregion_df$consistency)) - 
  mean(as.numeric(factor(subregion_df$consistency)))

subregion_df$logrt = log(subregion_df$rt)
subregion_df$wordlen = nchar(as.character(subregion_df$form))
subregion_df$logtrial = log(subregion_df$trial_no + 1)
subregion_resid_model <- lmer(logrt ~ wordlen + (0+wordlen|workerid), data = subregion_df)
subregion_res <- resid(subregion_resid_model)
subregion_df$residuals <- subregion_res
subregion_df$ctr_RT = as.numeric(subregion_df$residuals) - mean(subregion_df$residuals)

#looking at raw, not residualized, RTs grouped by consistency and name category
rawgrouped = subregion_df %>%
  group_by(region, consistency, nameCategory, trial_id) %>% 
  summarize(mean_rt = mean(rt),CILow=ci.low(rt),CIHigh=ci.high(rt)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_rt-CILow,YMax=mean_rt+CIHigh)

rawgrouped$region <- factor(rawgrouped$region, levels=c("pre_crit_2",
                                                        "pre_crit_1",
                                                        "crit",
                                                        "spillover_1",
                                                        "spillover_2",
                                                        "spillover_3",
                                                        "spillover_4"))

#looking at residuals
## grouped by trial
residuals_grouped2_bytrial = subregion_df %>%
  group_by(region, consistency, nameCategory, trial_id) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)


residuals_grouped2_bytrial$region <- factor(residuals_grouped2_bytrial$region,
                                            levels=c("pre_crit_2",
                                                     "pre_crit_1",
                                                     "crit",
                                                     "spillover_1",
                                                     "spillover_2",
                                                     "spillover_3",
                                                     "spillover_4"))
residuals_grouped2_bytrial <- residuals_grouped2_bytrial %>%
  mutate(bias = case_when(((nameCategory == "black" & consistency == "consistent")
                           | (nameCategory == "white" & consistency == "inconsistent")) ~ 
                             "Evoking Criminality",
                          TRUE ~ "Not Evoking Criminality"))

## grouped by name
residuals_grouped2_byname = subregion_df %>%
  group_by(region, consistency, nameCategory) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)


residuals_grouped2_byname$region <- factor(residuals_grouped2_byname$region,
                                           levels=c("pre_crit_2",
                                                    "pre_crit_1",
                                                    "crit",
                                                    "spillover_1",
                                                    "spillover_2",
                                                    "spillover_3",
                                                    "spillover_4"))
residuals_grouped2_byname$nameCategory <- recode(residuals_grouped2_byname$nameCategory, 
                                                 "black" = "Black-normed Names",
                                                 "white" = "White-normed Names")

#white-biased items (i.e. not evoking criminality)
##by name
residuals_wbias_byname = subregion_df %>%
  group_by(region, bias, nameCategory) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)

residuals_wbias_byname$region <- factor(residuals_wbias_byname$region)
###for crim
residuals_wbias_byname$region <- factor(residuals_wbias_byname$region, 
                                 levels=c("pre_crit_2",
                                          "pre_crit_1",
                                          "crit",
                                          "spillover_1",
                                          "spillover_2",
                                          "spillover_3",
                                          "spillover_4"))
residuals_wbias_byname$bias <- recode(residuals_wbias_byname$bias, "black" = "Evoking Criminality",
                                                                "white" = "Not Evoking Criminality")
##by trial
residuals_wbias_bytrial = subregion_df %>%
  group_by(region, bias, nameCategory, trial_id) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)

residuals_wbias_bytrial$region <- factor(residuals_wbias_bytrial$region)
residuals_wbias_bytrial$region <- factor(residuals_wbias_bytrial$region, 
                                 levels=c("pre_crit_2",
                                          "pre_crit_1",
                                          "crit",
                                          "spillover_1",
                                          "spillover_2",
                                          "spillover_3",
                                          "spillover_4"))
residuals_wbias_bytrial$bias <- recode(residuals_wbias_bytrial$bias, "black" = "black-typical",
                                                        "white" = "white-typical")
```

###More dataframe information/transformation
```{r}
#obtaining per-trial reading time (and excluding data > 2.5 standard deviations away from the mean)
df <- df %>%
  group_by(workerid, trial_no) %>%
  mutate(trial_time = sum(rt)) 

trialTimeMean <- mean(df$trial_time)
trialTimeSD <- sd(df$trial_time)
slowTrial <- trialTimeMean + (2.5 * trialTimeSD)
fastTrial <- trialTimeMean - (2.5 * trialTimeSD)

df <- df %>%
  filter(!(trial_time > slowTrial || trial_time < fastTrial))

#data transformations: log transform & word length
df$logrt = log(df$rt)
df$wordlen = nchar(as.character(df$form))
df$logtrial = log(df$trial_no + 1)
```

###Setting up residualized reading times
```{r}
#regress word length and overall trial number onto log RT (ie, subtract out the variance contributed by these factors.)
resid_model = lmer(logrt ~ wordlen + (0+wordlen|workerid), data = df)
res = resid(resid_model)

df$residuals <- res
```

###Specific dataframes
```{r eval = FALSE}
#items in the "critical" region
criticaldf <- filter(df, region == "crit", type == "critical")
criticaldf$bias <- factor(criticaldf$bias)
criticaldf$nameCategory <- factor(criticaldf$nameCategory)
criticaldf <- criticaldf %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

criticaldf$ctr_nameCategory = as.numeric(criticaldf$nameCategory) - mean(as.numeric(criticaldf$nameCategory))
criticaldf$ctr_consistency = as.numeric(factor(criticaldf$consistency)) - mean(as.numeric(factor(criticaldf$consistency)))
criticaldf$ctr_crim = as.numeric(factor(criticaldf$bias)) - mean(as.numeric(factor(criticaldf$bias)))

#items in spillover regions 1 and 2
spilloverdf <- filter(df, region %in% c("spillover_1", "spillover_2"), type == "critical")
spilloverdf$bias <- factor(spilloverdf$bias)
spilloverdf$nameCategory <- factor(spilloverdf$nameCategory)
spilloverdf <- spilloverdf %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

spilloverdf$ctr_nameCategory = as.numeric(spilloverdf$nameCategory) - mean(as.numeric(spilloverdf$nameCategory))
spilloverdf$ctr_consistency = as.numeric(factor(spilloverdf$consistency)) - mean(as.numeric(factor(spilloverdf$consistency)))
spilloverdf$ctr_crim = as.numeric(factor(spilloverdf$bias)) - mean(as.numeric(factor(spilloverdf$bias)))
spilloverdf$ctr_logtrial = as.numeric(spilloverdf$logtrial) - mean(as.numeric(spilloverdf$logtrial))

#items in just spillover_1
spillover1_df <- filter(df, region %in% c("spillover_1"), type == "critical")
spillover1_df$bias <- factor(spillover1_df$bias)
spillover1_df$nameCategory <- factor(spillover1_df$nameCategory)
spillover1_df <- spillover1_df %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

spillover1_df$ctr_nameCategory = as.numeric(spillover1_df$nameCategory) - mean(as.numeric(spillover1_df$nameCategory))
spillover1_df$ctr_consistency = as.numeric(factor(spillover1_df$consistency)) - mean(as.numeric(factor(spillover1_df$consistency)))
spillover1_df$ctr_crim = as.numeric(factor(spillover1_df$bias)) - mean(as.numeric(factor(spillover1_df$bias)))

#items in just spillover_2
spillover2_df <- filter(df, region %in% c("spillover_2"), type == "critical")
spillover2_df$bias <- factor(spillover2_df$bias)
spillover2_df$nameCategory <- factor(spillover2_df$nameCategory)
spillover2_df <- spillover2_df %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

spillover2_df$ctr_nameCategory = as.numeric(spillover2_df$nameCategory) - mean(as.numeric(spillover2_df$nameCategory))
spillover2_df$ctr_consistency = as.numeric(factor(spillover2_df$consistency)) - mean(as.numeric(factor(spillover2_df$consistency)))
spillover2_df$ctr_crim = as.numeric(factor(spillover2_df$bias)) - mean(as.numeric(factor(spillover2_df$bias)))

#items in just spillover_3
spillover3_df <- filter(df, region %in% c("spillover_3"), type == "critical")
spillover3_df$bias <- factor(spillover3_df$bias)
spillover3_df$nameCategory <- factor(spillover3_df$nameCategory)
spillover3_df <- spillover3_df %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

spillover3_df$ctr_nameCategory = as.numeric(spillover3_df$nameCategory) - mean(as.numeric(spillover3_df$nameCategory))
spillover3_df$ctr_consistency = as.numeric(factor(spillover3_df$consistency)) - mean(as.numeric(factor(spillover3_df$consistency)))
spillover3_df$ctr_crim = as.numeric(factor(spillover3_df$bias)) - mean(as.numeric(factor(spillover3_df$bias)))


#Looking at how quickly the names themselves were read
name_region_df <- filter(df, region == "name", type == "critical")

name_region_df$bias <- factor(name_region_df$bias)
name_region_df$nameCategory <- factor(name_region_df$nameCategory)
name_region_df <- name_region_df %>%
  mutate(consistency = case_when(bias == nameCategory ~ "consistent", TRUE ~ "inconsistent"))

name_region_df$ctr_nameCategory = as.numeric(name_region_df$nameCategory) - 
  mean(as.numeric(name_region_df$nameCategory))
name_region_df$ctr_consistency = as.numeric(factor(name_region_df$consistency)) - 
  mean(as.numeric(factor(name_region_df$consistency)))

name_RT_byBias = name_region_df %>%
  group_by(region, bias, nameCategory) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)

name_RT_byBias$bias <- recode(name_RT_byBias$bias, "black" = "black-typical",
                                       "white" = "white-typical")

name_RT_byBias_raw = name_region_df %>%
  group_by(region, bias, nameCategory) %>% 
  summarize(meanRT = mean(rt), CILow=ci.low(rt), CIHigh=ci.high(rt)) %>% 
  ungroup() %>% 
  mutate(YMin=meanRT-CILow,YMax=meanRT+CIHigh)

name_RT_byBias_raw$bias <- recode(name_RT_byBias_raw$bias, "black" = "black-typical",
                              "white" = "white-typical")

```

#1. Visualizations
## "The Main Plots"
Comparing the same items being read but with different names:
```{r echo = FALSE}
ggplot(residuals_wbias_byname, aes(x=region, y=mean_resid, color=nameCategory, group=nameCategory)) + 
  facet_wrap(~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  scale_colour_manual("Name Bias", values = c("#00397A","#CCCCCC")) +
  labs(x = "Sentence Region", y = "Residualized/Centered RT (ms)", fill = "Type")  +
  #scale_x_discrete(labels = c("White", "Black")) +
  ggtitle("Mean Reading Times for Black- and White-typical Completions") +
  theme(title = element_text(size=18), legend.text = element_text(size=15),
        axis.text = element_text(angle = 30, size = 12),
        strip.text = element_text(size=12))
```
Here, we would expect the gray line to have higher values on the left (as this is an inconsistent pairing a White-normed name and a stimulus that evokes criminality), and the blue line to have higher values on the right.


Comparing the same kind of names being read but with different items
```{r echo = FALSE}
ggplot(residuals_grouped2_byname, aes(x=region, y=mean_resid, color=consistency, group=consistency)) + 
  facet_wrap(~nameCategory) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  scale_colour_manual("Stereotype\nConsistency", values = c("#00397A","#CCCCCC")) +
  labs(x = "Sentence Region", y = "Residualized/Centered RT (ms)", fill = "Type")  +
  ggtitle("Mean Reading Times for Black- and White-typical Completions") +
  theme(title = element_text(size=18), legend.text = element_text(size=15),
        axis.text = element_text(angle = 30, size = 12),
        strip.text = element_text(size=12))
```
Here, we had hypothesized that the gray lines would be above the blue lines for both graphs, as they represent inconsistent stimuli. To review, "inconsistent" on the left side (with Black-normed names) reflects the property of _**not** evoking criminality_, while on the right "inconsistent" reflects the property of *evoking criminality*.

##Data values for individual stories
Raw RT values
```{r echo = FALSE}
ggplot(residuals_grouped2_bytrial, aes(x=region, y=mean_resid, color=consistency, group=consistency)) + 
  facet_grid(bias~trial_id) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```
Residualized and centered RT values; stims not evoking criminality
```{r echo = FALSE}
ggplot(filter(residuals_wbias_bytrial, bias == "white-typical"), 
       aes(x=region, y=mean_resid, color=nameCategory, group=nameCategory)) + 
  facet_wrap(trial_id~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```
Residualized and centered RT values; stims evoking criminality
```{r echo = FALSE}
ggplot(filter(residuals_wbias_bytrial, bias == "black-typical"), 
       aes(x=region, y=mean_resid, color=nameCategory, group=nameCategory)) + 
  facet_wrap(trial_id~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```


##Ordering effects
####Setting up the data
```{r eval = FALSE}
subregion_df <- subregion_df %>%
  mutate(quarter = case_when((trial_no <= 4) ~ "firstQuarter",
                             (trial_no >= 13) ~ "lastQuarter",
                             TRUE ~ "middleHalf")) %>%
  mutate(half = case_when((trial_no < 9) ~ "firstHalf",
                          (trial_no > 8) ~ "secondHalf",
                          TRUE ~ "other"))

#by quarter
residuals_orderEffects_Q = subregion_df %>%
  group_by(region, bias, nameCategory, quarter) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)
residuals_orderEffects_Q$region <- factor(residuals_orderEffects_Q$region)
residuals_orderEffects_Q$region <- factor(residuals_orderEffects_Q$region, 
                                         levels=regionLabels)
residuals_orderEffects_Q$bias <- recode(residuals_orderEffects_Q$bias, "black" = "black-typical",
                                       "white" = "white-typical")

#by half
residuals_orderEffects_H = subregion_df %>%
  group_by(region, bias, nameCategory, half) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)
residuals_orderEffects_H$region <- factor(residuals_orderEffects_H$region)
residuals_orderEffects_H$region <- factor(residuals_orderEffects_H$region, 
                                          levels=regionLabels)
residuals_orderEffects_H$bias <- recode(residuals_orderEffects_H$bias, "black" = "black-typical",
                                        "white" = "white-typical")
```

####Visualizations
By the number of terms seen:
```{r echo = FALSE}
ggplot(filter(df, type == "critical"), aes(x=trial_no, y=rt, col=type)) + 
  geom_point(alpha=.2)  + 
  geom_smooth() + 
  #colscale +
  labs(x='Item order (#RCs seen)', y='Raw RTs (ms)', fill='Type')
```
By the number of sentences seen:
```{r echo = FALSE}
grouped = subregion_df %>% 
  group_by(trial_no, type) %>% 
  summarize(rt = mean(residuals))
ggplot(grouped, aes(x=trial_no, y=rt, col=type)) + 
  geom_point() +
  geom_smooth(method="lm") + 
  #colscale +
  labs(x='Item order (#sentences seen)', y='Length- and order-corrected log RTs (ms)', fill='Type')
```

####Residualized reading time data facetted by quarter:
By comparing stims of the same items:
```{r echo = FALSE}
ggplot(residuals_orderEffects_Q, aes(x=region, y=mean_resid, color=nameCategory, 
                                     group=nameCategory)) + 
  facet_grid(quarter~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```

Facetted by nameCategory and bias, with the quarter as the lines' colours:
```{r echo = FALSE}
ggplot(residuals_orderEffects_Q, aes(x=region, y=mean_resid, color=quarter, 
                                     group=nameCategory)) + 
  facet_grid(nameCategory~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```

####Residualized reading time data facetted by half:
Comparing stims of the same items:
```{r echo = FALSE}
ggplot(residuals_orderEffects_H, aes(x=region, y=mean_resid, color=nameCategory, 
                                     group=nameCategory)) + 
  facet_grid(half~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```

Facetted by nameCategory and bias, with the half as the lines' colours:
```{r echo = FALSE}
ggplot(residuals_orderEffects_H, aes(x=region, y=mean_resid, color=half, 
                                     group=nameCategory)) + 
  facet_grid(nameCategory~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```


##Sub-group (demographic) explorations
###Setting up the dataframes
```{r eval = FALSE}
subinfo <- subinfo %>%
  filter(!(workerid %in% excludeList))# %>%
  #mutate(age = as.numeric(subinfo$age)) %>%
  #mutate(affiliation = as.numeric(subinfo$affiliation))

#political affiliation
subinfo <- subinfo %>%
  mutate(affiliationGroup = case_when((affiliation > -1) & (affiliation < 3) ~ "liberal",
                                      (affiliation == 3) ~ "independent",
                                      (affiliation > 3) ~ "conservative",
                                      TRUE ~ "no response"))
liberalIDs <- filter(subinfo, affiliationGroup == "liberal")$workerid
independentIDs <- filter(subinfo, affiliationGroup == "independent")$workerid
conservativeIDs <- filter(subinfo, affiliationGroup == "conservative")$workerid
noAffIDs <- filter(subinfo, affiliationGroup == "no response")$workerid

demographics_df <- subregion_df %>%
  mutate(affiliationGroup = case_when((workerid %in% liberalIDs) ~ "liberal",
                                      (workerid %in% independentIDs) ~ "independent",
                                      (workerid %in% conservativeIDs) ~ "conservative",
                                      (workerid %in% noAffIDs) ~ "no response",
                                      TRUE ~ "other"))
residuals_affiliation = demographics_df %>%
  group_by(region, bias, nameCategory, affiliationGroup) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)
residuals_affiliation$region <- factor(residuals_affiliation$region)
residuals_affiliation$region <- factor(residuals_affiliation$region, 
                                          levels=regionLabels)
residuals_affiliation$bias <- recode(residuals_affiliation$bias, "black" = "black-typical",
                                        "white" = "white-typical")

#racial demographics
subinfo <- subinfo %>%
  mutate(raceGroup = case_when(((race == "AA") | (race == "AA, White") | (race == "AA, Latino")
                                | (race == "Asian, AA, White") | (race == "AA, Latino, White"))
                                ~ "AA",
                               ((race == "Latino") | (race == "Latino, White")) ~ "Latinx",
                               ((race == "Asian") | (race == "Asian, White")) ~ "Asian",
                               (race == "White") ~ "White",
                               TRUE ~ "not reported"))

AA_ids <- filter(subinfo, raceGroup == "AA")$workerid
Latinx_ids <- filter(subinfo, raceGroup == "Latinx")$workerid
Asian_ids <- filter(subinfo, raceGroup == "Asian")$workerid
White_ids <- filter(subinfo, raceGroup == "White")$workerid

demographics_df <- demographics_df %>%
  mutate(raceGroup = case_when((workerid %in% AA_ids) ~ "AA",
                                      (workerid %in% Latinx_ids) ~ "Latinx",
                                      (workerid %in% Asian_ids) ~ "Asian",
                                      (workerid %in% White_ids) ~ "White",
                                      TRUE ~ "not reported"))

residuals_race = demographics_df %>%
  group_by(region, bias, nameCategory, raceGroup) %>% 
  summarize(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)
residuals_race$region <- factor(residuals_race$region)
residuals_race$region <- factor(residuals_race$region, 
                                       levels=regionLabels)
residuals_race$bias <- recode(residuals_race$bias, "black" = "black-typical",
                                     "white" = "white-typical")

#Age demographic
library(Hmisc) #for the cut2() function
library(dplyr) #for the cut2() function
averageAge <- mean(subinfo$age, na.rm = TRUE)
subinfo$ageGroup2 <- as.numeric(cut2(as.numeric(subinfo$age), g=3))
subinfo <- subinfo %>%
  mutate(ageGroup = case_when((ageGroup2 == 1) ~ "younger third",
                              (ageGroup2 == 2) ~ "middle third",
                              (ageGroup2 == 3) ~ "older third",
                              TRUE ~ "other"))
olderAgeIDs <- filter(subinfo, ageGroup == "older third")$workerid
middleAgeIDs <- filter(subinfo, ageGroup == "middle third")$workerid
youngerAgeIDs <- filter(subinfo, ageGroup == "younger third")$workerid

demographics_df <- demographics_df %>%
  mutate(ageGroup = case_when((workerid %in% olderAgeIDs) ~ "older third",
                              (workerid %in% middleAgeIDs) ~ "middle third",
                              (workerid %in% youngerAgeIDs) ~ "younger third",
                              TRUE ~ "other"))

residuals_age = demographics_df %>%
  group_by(region, bias, nameCategory, ageGroup) %>% 
  summarise(mean_resid = mean(residuals), CILow=ci.low(residuals), CIHigh=ci.high(residuals)) %>% 
  ungroup() %>% 
  mutate(YMin=mean_resid-CILow,YMax=mean_resid+CIHigh)
residuals_age$region <- factor(residuals_age$region)
residuals_age$region <- factor(residuals_age$region, 
                                       levels=regionLabels)
residuals_age$bias <- recode(residuals_age$bias, "black" = "black-typical",
                                     "white" = "white-typical")
#detaching packages that could conflict with others in the script
detach("package:dplyr", unload = TRUE)
detach("package:Hmisc", unload = TRUE)
```

###Political affiliation
Categorized into "liberal", "conservative", and "independent"
```{r echo = FALSE}
ggplot(residuals_affiliation, aes(x=region, y=mean_resid, color=nameCategory, 
                                     group=nameCategory)) + 
  facet_grid(affiliationGroup~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```

###Race
```{r echo = FALSE}
ggplot(residuals_race, aes(x=region, y=mean_resid, color=nameCategory, 
                                  group=nameCategory)) + 
  facet_grid(raceGroup~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```

####Further looking at White participants
```{r echo = FALSE}
ggplot(dplyr::filter(residuals_race, raceGroup == "White"), aes(x=region, y=mean_resid, color=nameCategory, 
                           group=nameCategory)) + 
  facet_grid(~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```

###Age
```{r echo = FALSE}
ggplot(residuals_age, aes(x=region, y=mean_resid, color=nameCategory, 
                                  group=nameCategory)) + 
  facet_grid(ageGroup~bias) +
  geom_point()  + 
  geom_errorbar(aes(ymin=YMin,ymax=YMax),width=.25) +
  geom_line() +
  labs(x='Sentence region', y='Residualized/Centered RT (ms)', fill='Type') +
  theme(axis.text.x = element_text(angle = 30))
```


#2. Modeling the data
The models here make use of the [lme4 ("Linear Mixed-Effects Models using 'Eigen' and S4") package](https://cran.r-project.org/web/packages/lme4/lme4.pdf), specifically using the Fit Linear Mixed-Effects Models ("lmer") formula.
##Creating the models
```{r eval = FALSE}
#consistency as a fixed effect
##critical item reading times
###preregistered model — not enough observations to converge the model
prereg_model = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency + 
               (1 + (logtrial * ctr_nameCategory * ctr_consistency) | trial_id) + 
               (1 + (logtrial * ctr_nameCategory * ctr_consistency) | workerid), 
             criticaldf, REML = F)
###simplified model
simpler_model = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency + 
               (1 | trial_id) + 
               (1 | workerid), 
             criticaldf, REML = F)

##spillover items reading times
###simpler model for regions 1 and 2
simple_spill_model = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency + 
                     (1 | trial_id) + 
                     (1 | workerid), 
                   spilloverdf, REML = F)
###involving nameCategory and Consistency as random effects, still regions 1 and 2
spillover_model = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency +
                           (1 + (ctr_nameCategory * ctr_consistency) | trial_id) +
                           (1 + (ctr_nameCategory * ctr_consistency) | workerid),
                         spilloverdf, REML = F)
###including a centered log-trial as a fixed effect, regions 1 and 2
spillover_model_logctr = lmer(residuals ~ ctr_logtrial * ctr_nameCategory * ctr_consistency +
                           (1 + (ctr_nameCategory * ctr_consistency) | trial_id) +
                           (1 + (ctr_nameCategory * ctr_consistency) | workerid),
                         spilloverdf, REML = F)
###focusing on spillover region 1
model_spillover1region = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency +
                                (1 + (ctr_nameCategory * ctr_consistency) | trial_id) +
                                (1 + (ctr_nameCategory * ctr_consistency) | workerid),
                              spillover1_df, REML = F)
###focusing on spillover region 2
model_spillover2region = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency +
                                (1 + (ctr_nameCategory * ctr_consistency) | trial_id) +
                                (1 + (ctr_nameCategory * ctr_consistency) | workerid),
                              spillover2_df, REML = F)
###focusing on spillover region 3
model_spillover3region = lmer(residuals ~ logtrial * ctr_nameCategory * ctr_consistency +
                           (1 + (ctr_nameCategory * ctr_consistency) | trial_id) +
                           (1 + (ctr_nameCategory * ctr_consistency) | workerid),
                         spillover3_df, REML = F)


#criminality as a fixed effect
##critical item reading times, simpler model
criminalityModel_crit <- lmer(residuals ~ logtrial * ctr_nameCategory * ctr_crim + 
                                (1 | trial_id) + 
                                (1 | workerid), 
                              criticaldf, REML = F)
##critical item reading times, more robust model
criminalityModel_crit_robust <- lmer(residuals ~ logtrial * ctr_nameCategory * ctr_crim + 
                                (1 + ctr_nameCategory | trial_id) + 
                                (1 + (ctr_nameCategory * ctr_crim) | workerid), 
                              criticaldf, REML = F)
##spillover regions 1 and 2, simpler model
criminalityModel_spill <- lmer(residuals ~ logtrial * ctr_nameCategory * ctr_crim + 
                                (1 | trial_id) + 
                                (1 | workerid), 
                              spilloverdf, REML = F)
##spillover regions 1 and 2, more robust model
criminalityModel_spill_robust <- lmer(residuals ~ logtrial * ctr_nameCategory * ctr_crim + 
                                  (1 + ctr_nameCategory | trial_id) + 
                                  (1 + (ctr_nameCategory * ctr_crim) | workerid), 
                               spilloverdf, REML = F)
```
##Each model's summary
###Consistency as a fixed effect
For these models, a *negative* value for consistency reflects a *consistent* stimulus (e.g. a stimulus **evoking** criminality and containing a Black-normed name), and a *positive* value for consistency reflects an *inconsistent* stimulus (e.g. a stimulus **not evoking** criminality and containing a Black-normed name).
Here, a *negative* value for nameCategory reflects a White-normed name, while a *positive* value reflects a Black-normed name.

As such, we had hypothesized that consistency should have a *positive* correlation with reading time (as an inconsistent stimulus would result in a longer reading time).
```{r echo = FALSE, eval=FALSE}
summary(prereg_model)
```
```{r echo = FALSE}
summary(simpler_model)
```
```{r echo = FALSE}
summary(simple_spill_model)
```
```{r echo = FALSE}
summary(spillover_model)
```
```{r echo = FALSE}
summary(spillover_model_logctr)
```
```{r echo = FALSE}
print("spillover 1:")
summary(model_spillover1region)
print("spillover 2:")
summary(model_spillover2region)
print("spillover 3:")
summary(model_spillover3region)
```

###Criminality as a fixed effect
For these models, a *negative* value for criminality reflects a stimulus that evokes criminality (such as "stole" instead of "bought"), while a *positive* value reflects non-criminality ("bought" instead of "stole"). As in the previous models, a *negative* value for nameCategory reflects a White-normed name, while a *positive* value reflects a Black-normed name.

As such, we would expect reading times to be positively influenced by the interaction between nameCategory and criminality, as a Black-normed name not evoking criminality would be read more slowly.
```{r echo = FALSE}
summary(criminalityModel_crit)
```
```{r echo = FALSE}
summary(criminalityModel_crit_robust)
```
```{r echo = FALSE}
summary(criminalityModel_spill)
```
```{r echo = FALSE}
summary(criminalityModel_spill_robust)
```


These models (and the graphs above) suggest that the data collected is unable to disprove the null hypotheses.